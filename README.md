# MIDI FallingBar

これは、現代の自動演奏ピアノやSynthesiaスタイルの動画にインスパイアされた、MIDIノートを3Dピアノロール形式の「落下するバー」として表示するウェブベースのMIDIビジュアライザーです。WebGLレンダリングには`Three.js`を、MIDIファイルのパースには`@tonejs/midi`を使用しています。

## 特徴

  - **3Dビジュアライゼーション**: ノートが3Dのピアノキーボード上に落下するバーとしてレンダリングされます。
  - **楽器のサポート**: MIDIチャンネルごとに異なる色が割り当てられ、さまざまなシンセサイザー音源にマッピングできます。
  - **再生コントロール**: MIDIファイルの再生、一時停止、シークが可能です。
  - **再生速度コントロール**: 再生速度を0.5倍から2.0倍まで調整できます。
  - **カスタマイズ可能なカメラ**: パースビュー（斜めからの視点）とトップダウンビュー（真上からの視点）を切り替えられます。
  - **パフォーマンスモード**: お使いのハードウェアに合わせて、異なるレンダリング品質モードを選択し、動作を最適化できます。
  - **ドラッグ＆ドロップ**: MIDIファイルをページ上にドラッグ＆ドロップするだけで開始できます。
  - **ピクチャー・イン・ピクチャー (PiP)**: 他の作業をしながら、フローティングウィンドウでビジュアライゼーションを視聴できます。

## 使い方

1.  **ビジュアライザーを開く**: デプロイされたリンクにアクセスするか、ローカルで実行している場合は`dist/index.html`を開きます。
2.  **MIDIファイルを読み込む**:
      - 「ファイルを選択」ボタンをクリックして、お使いのコンピュータから`.mid`または`.midi`ファイルを選択します。
      - または、MIDIファイルをページのどこにでもドラッグ＆ドロップします。
3.  **再生のコントロール**:
      - **再生/一時停止**ボタンで音楽を開始・停止します。
      - **プログレスバー**をクリックして、曲の特定の位置にシークします。
      - **←/→（左右矢印）キー**で10秒間戻ったり進んだりできます。
      - **速度**ドロップダウンメニューで再生速度を変更します。
4.  **表示のカスタマイズ**:
      - **チャンネル楽器**: このセクションを展開して、各MIDIチャンネルに異なるシンセサイザー音源を割り当て、音量を調整します。
      - **トップダウンビュー**: チェックボックスをオンにすると、ピアノを真上から見た視点に切り替わります。
      - **ズーム**: マウスホイール、トラックパッド、または`-`キーと`+`キーでズームイン・ズームアウトします。
      - **パフォーマンスモード**: 動作が遅い場合は、「軽量」モードへの切り替えを試してください。

## 開発

### 前提条件

  - [Node.js](https://nodejs.org/) (`package.json`の`volta`フィールドで指定されたバージョン)
  - [npm](https://www.npmjs.com/)

### セットアップ

1.  リポジトリをクローンします:
    ```bash
    git clone https://github.com/hi2ma-bu4/MIDI-FallingBar.git
    ```
2.  プロジェクトディレクトリに移動します:
    ```bash
    cd MIDI-FallingBar
    ```
3.  依存関係をインストールします:
    ```bash
    npm install
    ```

### 開発サーバーの実行

ホットリロード機能付きのローカル開発サーバーを起動するには:

```bash
npm start
```

これにより、デフォルトのウェブブラウザで`http://localhost:8080`が開き、ビジュアライザーが表示されます。

### プロダクションビルド

最適化されたプロダクションビルドを作成するには:

```bash
npm run build
```

バンドルされたファイルは`dist/`ディレクトリに配置されます。このディレクトリを任意の静的ウェブホストにデプロイできます。
